---
// src/pages/index.astro
import BaseLayout from "../layouts/BaseLayout.astro";
import ProductCard from "../components/ProductCard.astro";
import Carousel from "../components/Carousel.astro";
import NewProducts from "../components/NewProducts.jsx";
import apiClient from "../api/apiClient.jsx";

// Fetch only the featured products at build time
let featured = [];
try {
  const data = await apiClient.products.getPage(0, 8);
  featured = data.content || [];
} catch (err) {
  console.error("Featured products could not be fetched:", err);
  featured = [];
}
---
<BaseLayout title="–ù“Ø“Ø—Ä —Ö—É—É–¥–∞—Å">
  <div class="px-[3%] py-3 2xl:px-[8%]">
    <!-- Hero Carousel -->
    <Carousel />
  </div>

  <section class="max-w-7xl mx-auto px-6 lg:px-8">
    <!-- üéÅ Top Banner Row -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 my-8">
      <a href="/sale" class="block rounded-lg overflow-hidden shadow-md hover:shadow-lg transition">
        <img
          src="/img/sale.jpg"
          alt="–•—è–º–¥—Ä–∞–ª"
          class="w-full h-full object-cover rounded-lg"
        />
      </a>
      <a href="/new" class="block rounded-lg overflow-hidden shadow-md hover:shadow-lg transition">
        <img
          src="/img/new.jpg"
          alt="–®–∏–Ω—ç –±“Ø—Ç—ç—ç–≥–¥—ç—Ö“Ø“Ø–Ω"
          class="w-full h-full object-cover rounded-lg"
        />
      </a>
    </div>

    <!-- Featured row -->
    <div class="mt-6 shadow-inner p-4 rounded-lg bg-white">
      <div class="flex items-center gap-2 text-gray-700 mb-3">
        <span class="h-3 w-3 rounded-full bg-[#003375]"></span>
        <h2 class="text-xl font-semibold">–û–Ω—Ü–ª–æ—Ö</h2>
      </div>
      <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 xl:grid-cols-4 gap-4">
        {featured.map((p: any) => (
          <ProductCard product={p} />
        ))}
      </div>
    </div>

    <!-- üéÅ Mid-Page Banner (Free Shipping, Promo, etc.) -->
    <div class="my-10">
      <a href="/delivery" class="block">
        <img
          src="https://placehold.co/1200x200/f7941e/ffffff?text=100'000+‚ÇÆ-—Å+–¥—ç—ç—à+“Ø–Ω—ç–≥“Ø–π+—Ö“Ø—Ä–≥—ç–ª—Ç"
          alt="“Æ–Ω—ç–≥“Ø–π —Ö“Ø—Ä–≥—ç–ª—Ç"
          class="w-full h-auto rounded-xl shadow-md transition-transform hover:scale-[1.01] duration-300"
        />
      </a>
    </div>

    <!-- üéÅ 3 Small Promo Banners -->
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-6 my-10">
      <a href="/category/5144" class="block">
        <img
          src="../img/electronics.jpg"
          alt="–¶–∞—Ö–∏–ª–≥–∞–∞–Ω –±–∞—Ä–∞–∞"
          class="w-full rounded-lg shadow hover:opacity-90 transition"
        />
      </a>
      <a href="/category/97" class="block">
        <img
          src="../img/book.jpg"
          alt="–ù–æ–º"
          class="w-full rounded-lg shadow hover:opacity-90 transition"
        />
      </a>
      <a href="/category/126" class="block">
        <img
          src="../img/house.jpg"
          alt="–ì—ç—Ä –∞—Ö—É–π"
          class="w-full rounded-lg shadow hover:opacity-90 transition"
        />
      </a>
    </div>

    <!-- All products -->
    <NewProducts client:load />
  </section>
</BaseLayout>
